cmake_minimum_required (VERSION 3.1)
project (onboardproject)

find_package(Threads REQUIRED)

set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11 -fPIC -g")
if(CMAKE_CXX_COMPILER_VERSION VERSION_LESS 4.8)
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -fpermissive -D_GLIBCXX_USE_SCHED_YIELD -D_GLIBCXX_USE_NANOSLEEP")
endif()

file(GLOB SOURCES
${CMAKE_CURRENT_SOURCE_DIR}/*.cpp
)

include_directories (
${CMAKE_CURRENT_SOURCE_DIR}
)

add_library(onboard
SHARED
${SOURCES}
)

add_custom_command(TARGET onboard
POST_BUILD
COMMAND ${CMAKE_COMMAND} -E make_directory "${CMAKE_CURRENT_SOURCE_DIR}/test/"
COMMAND ${CMAKE_COMMAND} -E copy "${CMAKE_CURRENT_SOURCE_DIR}/OnboardService.h" "${CMAKE_CURRENT_SOURCE_DIR}/test/"
COMMAND ${CMAKE_COMMAND} -E copy $<TARGET_FILE:onboard> "${CMAKE_CURRENT_SOURCE_DIR}/test/"
)

set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/bin)
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/lib)
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/lib)
